<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Architecture Components Example - Room, LiveData, ViewModel $#124; Hun development blog</title>
<meta name="description" content="Architecture Component">


  <meta name="author" content="Hun">
  
  <meta property="article:author" content="Hun">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Hun development blog">
<meta property="og:title" content="Architecture Components Example - Room, LiveData, ViewModel">
<meta property="og:url" content="http://localhost:4000/android-kotlin/implementing-mvvm-android-livedata/">


  <meta property="og:description" content="Architecture Component">







  <meta property="article:published_time" content="2020-10-23T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/android-kotlin/implementing-mvvm-android-livedata/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Jeong Hun Kim",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Hun development blog Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Daily development record
          <span class="site-subtitle">Android & Flutter & Fullstack</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Home</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#android-kotlin" itemprop="item"><span itemprop="name">Android kotlin</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Architecture Components Example - Room, LiveData, ViewModel</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/profile/hun.png" alt="Hun" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Hun</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Steadlily growing developer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Republic of Korea</span>
        </li>
      

      
        
          
            <li><a href="https://github.com/ll0301" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Architecture Components Example - Room, LiveData, ViewModel">
    <meta itemprop="description" content="Architecture Component  ">
    <meta itemprop="datePublished" content="2020-10-23T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Architecture Components Example - Room, LiveData, ViewModel
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          7 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h2 id="architecture-component">Architecture Component</h2>
<p float="center">
  <img src="/assets/images/gif/2020-10-2318-56.gif" width="300" />
</p>

<p>Architecture Component 예제를 공부하면서 주요 기능으로 자리잡고 있는 <code class="language-plaintext highlighter-rouge">Room</code>, <code class="language-plaintext highlighter-rouge">LiveData</code>, <code class="language-plaintext highlighter-rouge">Repository</code> , <code class="language-plaintext highlighter-rouge">ViewModel</code>, 에 대하여 정리한 글이다.</p>

<p float="center">
<img src="/assets/images/png/architectureComponent.png" width="100%" />
</p>
<p>이미지 출처 및 참고자료 <br />
<a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view-kotlin?hl=ko#1">https://codelabs.developers.google.com/codelabs/android-room-with-a-view-kotlin?hl=ko#1</a></p>

<p>공식문서
<a href="import androidx.lifecycle.viewModelScope">Room</a>
<a href="https://developer.android.com/topic/libraries/architecture/livedata?hl=ko">LiveData</a>
<a href="https://developer.android.com/topic/libraries/architecture/viewmodel?hl=ko">ViewModel</a></p>

<h2 id="room"><code class="language-plaintext highlighter-rouge">Room</code>?</h2>
<p><code class="language-plaintext highlighter-rouge">Room</code>은 <code class="language-plaintext highlighter-rouge">SQLite</code> 추상화 레이어를 제공하여 <code class="language-plaintext highlighter-rouge">SQLite</code>를 완벽히 활용하면서 더 견고한 데이터 베이스 액세스를 가능하게 한다.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">SQLite</code> 데이터베이스 위에 있는 데이터베이스 계층이다.</li>
  <li>SQLiteOpenHelper로 처리하던 작업을 처리한다.</li>
  <li><code class="language-plaintext highlighter-rouge">DAO</code>를 사용하여 데이터베이스에 쿼리를 발급한다.</li>
  <li>성능저하를 피하기 위해 main thread 에서 Query를 사용하는 것을 허용하지 않는다.</li>
  <li><code class="language-plaintext highlighter-rouge">Room</code>에서 LiveData를 반환하면 백그라운드 스레드에서 Query 비동기로 자동실행된다.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//bulid.gradle

implementation "androidx.room:room-runtime:$rootProject.roomVersion"
kapt "androidx.room:room-compiler:$rootProject.roomVersion"
implementation "androidx.room:room-ktx:$rootProject.roomVersion"
androidTestImplementation "androidx.room:room-testing:$rootProject.roomVersion"
</code></pre></div></div>
<h4 id="entity"><code class="language-plaintext highlighter-rouge">Entity</code></h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Word.kt

@Entity(tableName = "word_table")
data class Word(@PrimaryKey @ColumnInfo(name = "word") val word: String)
</code></pre></div></div>
<ul>
  <li>@Entity(tableName =””)
    <ul>
      <li>SQLite table</li>
      <li>table name을 설정한다.</li>
    </ul>
  </li>
  <li>@PrimaryKey
    <ul>
      <li>모든 entity 는 primary key가 있어야한다.</li>
    </ul>
  </li>
  <li>@ColumnInfo -&gt; column 이름을 설정하고 유형을 지정한다.</li>
  <li>데이터베이스에 저장된 모든 속성은 public 이며 kotlin의 기본 설정이다.</li>
</ul>

<h4 id="dao"><code class="language-plaintext highlighter-rouge">DAO</code></h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//WordDao.kt

@Dao
interface WordDao {

    @Query("SELECT * from word_table ORDER BY word ASC")
    fun getAlphabetizedWords(): LiveData&lt;List&lt;Word&gt;&gt;

    @Insert(onConflict = OnConflictStrategy.IGNORE)
    suspend fun insert(word: Word)

    @Query("DELETE FROM word_table")
    suspend fun deleteAll()
}
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Dao</code>는 interface혹은 abstract 클래스로 설정해야 한다.</li>
  <li><code class="language-plaintext highlighter-rouge">@Dao</code>
    <ul>
      <li>Room을 위한 DAO 클래스로 식별한다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">@Insert</code>
    <ul>
      <li>SQL 문법이 필요없는 특별한 DAO 메소드 anottation이다.</li>
      <li>테이블에 데이터를 추가하는 용도</li>
      <li>동일하게 <code class="language-plaintext highlighter-rouge">@Update</code>, <code class="language-plaintext highlighter-rouge">@Delete</code>도 제공된다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">OnConflictStrategy.IGNORE</code>
    <ul>
      <li>입력된 값이 테이블에 있는 값과 동일하면 작업을 무시한다.</li>
    </ul>
  </li>
  <li>deleteAll()
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Delete</code>는 여러개의 entitiy 삭제할 수 없기 때문에 <code class="language-plaintext highlighter-rouge">@Query</code>로 직접 구현해야 한다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">@Query</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">@Query</code>는 string parameter로 되어있는 SQL을 입력받고 실행하는 annotation이다.</li>
      <li>구현을 위해 SQLite 문법을 이해하고 있어야 한다.</li>
    </ul>
  </li>
</ul>

<h4 id="roomdatabase"><code class="language-plaintext highlighter-rouge">RoomDatabase</code></h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//WordRoomDatabase.kt


@Database(entities = [Word::class], version = 1, exportSchema = false)
abstract class WordRoomDatabase : RoomDatabase() {

    // The database exposes DAOs through an abstract 'getter' method for each @Dao.
    abstract fun wordDao(): WordDao
		
		. . .
}

</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Room</code>클래스는 abstract로 선언해야 하며 <code class="language-plaintext highlighter-rouge">RoomDatabase</code>객체를 상속받아야 한다.</li>
  <li><code class="language-plaintext highlighter-rouge">@Database</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Entity</code>와 version을 입력받아 데이터베이스를 셋팅한다.</li>
      <li>각각의 <code class="language-plaintext highlighter-rouge">Entity</code>는 데이터베이스에 작성 될 테이블에 해당한다.</li>
      <li><code class="language-plaintext highlighter-rouge">exportSchema</code>
        <ul>
          <li>데이터베이스 마이그레이션은 코드의 범위를 벗어나므로 빌드 경고를 피하기 위해 여기서 exportSchema를 false로 설정해야한다.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>database schema가 변경될 경우 version number를 업데이트하고 migration을 관리해야 한다.</li>
  <li><code class="language-plaintext highlighter-rouge">wordDao()</code>
    <ul>
      <li>데이터베이스는 각각의 <code class="language-plaintext highlighter-rouge">DAO</code>에 대해 abstract getter 방법으로 제공한다.</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. . .
abstract fun wordDao(): WordDao

private class WordDatabaseCallback(
    private val scope: CoroutineScope
) : RoomDatabase.Callback() {

    override fun onOpen(db: SupportSQLiteDatabase) {
        super.onOpen(db)
        WordRoomDatabase.INSTANCE?.let { database -&gt;
            scope.launch {
                var wordDao = database.wordDao()

                // Delete all content here.
                wordDao.deleteAll()

                // Add sample words.
                var word = Word("Hello")
                wordDao.insert(word)
                word = Word("World!")
                wordDao.insert(word)

                // TODO: Add your own words!
                word = Word("TODO!")
                wordDao.insert(word)
            }
        }
    }
}
. . .
</code></pre></div></div>
<ul>
  <li>WordDatabase 인스턴스가 생성될 때 실행될 callback 함수이다.</li>
  <li>scope: CoroutineScope
    <ul>
      <li>Room의 Query는 main Thread에서 사용할 수 없다.
        <ul>
          <li>다른 Thread를 사용하기 위해 CoroutineScope를 입력받아 사용한다.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>wordDao의 동작
    <ul>
      <li>deleteAll() -&gt; entity를 모두 지운다.</li>
      <li>insert() -&gt; “Hello”, “World!”, “Todo” 3가지 객체를 생성하고 insert 한다.</li>
    </ul>
  </li>
  <li>실제 데이터베이스에서 entity가 초기화 되어야 하거나 꼭 있어야하는 데이터가 있을 경우 위 방법을 통해 구현한다.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. . .
companion object {
    @Volatile
    private var INSTANCE: WordRoomDatabase? = null

    fun getDatabase(
        context: Context,
        scope: CoroutineScope
    ): WordRoomDatabase {
        // if the INSTANCE is not null, then return it,
        // if it is, then create the database
        return INSTANCE ?: synchronized(this) {
            val instance = Room.databaseBuilder(
                context.applicationContext,
                WordRoomDatabase::class.java,
                "word_database"
            )
                .addCallback(WordRoomDatabase.WordDatabaseCallback(scope))
                .build()
            INSTANCE = instance
            // return instance
            instance
        }
    }
}
. . .
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">getDatabase()</code>
    <ul>
      <li>해당 메소드를 통해 Database 객체를 싱글턴으로 반환한다.</li>
      <li>context와 callback 함수 실행을 위해 CoroutinScope를 입력받는다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">Room.databaseBuilder()</code>
    <ul>
      <li>응용 프로그램 context에서 RoomDatabase 객체를 생성한다.</li>
      <li>context, Roomdatabase, database name을 입력받는다.</li>
      <li><code class="language-plaintext highlighter-rouge">addCallback()</code>
        <ul>
          <li>bulid 전 콜백함수를 실행하여 데이터를 초기화한다.</li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">bulid()</code>
        <ul>
          <li>마지막으로 빌드하고 instance를 반환한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="repository-"><code class="language-plaintext highlighter-rouge">Repository</code> ?</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Repository</code>는 여러 데이터 소스에 대한 액세스를 추상화한다.</li>
  <li>아키텍처 구성요소 라이브러리에 속하지 않지만 코드 분리 및 아키텍처를 위한 권장 모범 사례다.</li>
  <li>애플리케이션의 나머지 부분에 대한 데이터 액세스를 위한 API를 제공한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Repository</code>를 사용하는 이유
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Qeury</code>를 관리하고 여러 백엔드를 사용할 수 있도록 허용한다.</li>
      <li>Network와 Local 데이터베이스 사이에서 캐시된 결과를 어떻게 사용할지를 결정하기위한 로직을 구현한다.</li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// WordRepository.kt

class WordRepository(private val wordDao:WordDao) {

    val allWords: LiveData&lt;List&lt;Word&gt;&gt; = wordDao.getAlphabetizedWords()

    suspend fun insert(word: Word) {
        wordDao.insert(word)
    }
}

</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">DAO</code>를 private으로 생성함</li>
  <li><code class="language-plaintext highlighter-rouge">DAO</code>에 대한 액세스만 필요하므로 전체 데이터베이스 대신 DAO를 전달한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Room</code>은 별도의 쓰레드에서 모든 쿼리를 실행한다.</li>
  <li><code class="language-plaintext highlighter-rouge">Room</code>+ <code class="language-plaintext highlighter-rouge">DAO</code> 로 검색된 객체가 LiveData&lt;&gt;로 입력된다.
    <ul>
      <li>관찰된 LiveData는 변경 시 <code class="language-plaintext highlighter-rouge">Observer</code>에 통지한다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">suspend fun insert()</code>
    <ul>
      <li>suspend 를 붙임으로서 코루틴으로 언제든 지연되었다가 재개 될 수 있는 메소드가 정의된다.</li>
    </ul>
  </li>
</ul>

<h2 id="livedata"><code class="language-plaintext highlighter-rouge">LiveData</code>?</h2>
<p>데이터가 변경될 때 반응하는 <code class="language-plaintext highlighter-rouge">View</code>가 있다고 가정했을 때 데이터가 어떻게 저장되느냐에 따라 이것이 까다로울 수 있다. 앱의 여러가지 <code class="language-plaintext highlighter-rouge">View</code>에서 데이터 변경을 관찰하다 보면 코드줄이 길어지고 찾기 힘들어지면서 Test와 디버깅을 어렵게 만든다. <code class="language-plaintext highlighter-rouge">LiveData</code>는 이러한 문제를 해결한다.</p>

<ul>
  <li>식별 가능한 데이터 홀더 클래스</li>
  <li>일반 클래스와 달리 수명주기를 인식함</li>
  <li>activity, fragment, service등의 앱 구성요소 수명주기를 고려함</li>
  <li>수명주기 인식을 통해 활성상태에 있는 앱 구성요소의 관찰자만 업데이트 함</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>참고:
LiveData를 Room과 독립적으로 사용할 경우 데이터 업데이트를 관리해야한다. 
LiveData에는 저장된 데이터를 업데이트하는 데에 대한 공식적은 방법이 없다. 

LiveData 저장된 데이터를 업데이트 하려면 MutableLiveData를 사용해야한다. 
method -&gt; setValue(T), postValue(T)
일반적으로 MutableLiveData는 ViewModel 내에서 사용된다.
ViewModel은 immutable LiveData 객체만 Observers에게 노출시킨다. 
</code></pre></div></div>
<p>다음은 안드로이드 공식문서에 나와있는 LiveData의 장점이다.</p>
<h5 id="livedata의-장점"><code class="language-plaintext highlighter-rouge">LiveData</code>의 장점</h5>
<ul>
  <li>UI와 데이터 상태의 일치 보장
    <ul>
      <li><code class="language-plaintext highlighter-rouge">LiveData</code>는 수명주기 상태가 변경될 때 <code class="language-plaintext highlighter-rouge">Observer</code> 객체에 알림</li>
      <li>코드를 통합하여 <code class="language-plaintext highlighter-rouge">Observer</code>객체에 UI를 업데이트</li>
      <li>데이터가 변경될 때마다 관찰자가 UI를 업데이트 함</li>
    </ul>
  </li>
  <li>메모리누출 없음
    <ul>
      <li><code class="language-plaintext highlighter-rouge">Lifecylce</code> 객체와 관찰자가 결합되어 있고 수명주기가 끝나면 자동 삭제됨</li>
    </ul>
  </li>
  <li>중지된 activity로 인한 비정상 종료가 없음
    <ul>
      <li>관찰자의 수명주기가 비활성 상태이면 관찰자는 <code class="language-plaintext highlighter-rouge">LiveData</code> 이벤트를 수신하지 않음</li>
    </ul>
  </li>
  <li>수명주기를 수동으로 처리하지 않음
    <ul>
      <li>UI 구성요소는 관련 데이터를 관찰하기만 할 뿐 관찰을 중지하거나 다시 시작하지 않음</li>
      <li><code class="language-plaintext highlighter-rouge">LiveData</code>는 관찰하는 동안 관련 수명주기 상태의 변경을 인식하여 자동으로 관리</li>
    </ul>
  </li>
  <li>최신 데이터 유지
    <ul>
      <li>수명 주기가 비활성화 되고 다시 활성화 될 때 최신 데이터를 수신</li>
      <li>ex) 백그라운드에 있던 activity가 포그라운드로 돌아온 직후 최신 데이터 수신</li>
    </ul>
  </li>
  <li>적절한 구성 변경
    <ul>
      <li>구성 변경(ex-&gt;기기회전)으로 인해 activity, fragment 등이 다시 생성되면 사용할 수 있는 최신정보 를 즉시수신</li>
    </ul>
  </li>
  <li>리소스 공유
    <ul>
      <li>맵에서 시스템 서비스를 공유할 수 있도록 싱글톤 패턴을 사용하는 <code class="language-plaintext highlighter-rouge">LiveData</code> 객체를 확장하여 시스템 서비스를 래핑</li>
      <li><code class="language-plaintext highlighter-rouge">LiveData</code> 객체가 시스템 서비스에 한 번 연결되면 리소스가 필요한 모든 관찰자가 <code class="language-plaintext highlighter-rouge">LiveData</code> 객체를 볼 수 있음</li>
    </ul>
  </li>
</ul>

<h2 id="viewmodel"><code class="language-plaintext highlighter-rouge">ViewModel</code>?</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ViewModel</code>클래스는 수명주기를 고려하여 UI 관련 데이터를 저장하고 관리하도록 설계되었다.</li>
  <li><code class="language-plaintext highlighter-rouge">ViewModel</code> 클래스를 사용하면 화면 회전과 같이 구성을 변경할 때도 데이터를 유지할 수 있다.</li>
  <li><code class="language-plaintext highlighter-rouge">ViewModel</code>이 없는경우
    <ul>
      <li>Android 프레임워크는 UI Controller(activity,fragment..) 의 수명주기를 관리한다. 프레임워크는 특정 사용자 작업이나 완전히 통제할 수 없는 기기 이벤트에 대한 응답으로 UI 컨트롤러를 제거하거나 다시 만들도록 결정할 수 있다. 이러한 경우 컨트롤러에 저장된 일시적은 모든 UI 관련데이터가 손실된다.</li>
      <li>예를들어 activity의 view 구성의 변경을 위해 다시 생성하면 새 activity는 새로운 데이터를 처음부터 다시 가져와야 한다. 간단한 경우에는 <code class="language-plaintext highlighter-rouge">onSaveInstanceState()</code>메소드를 통해 복원할 수 있으나 이 경우는 소량의 데이터에만 적합하다.</li>
      <li>UI 컨트롤러가 비동기 호출을 자주 해야한다.
        <ul>
          <li>이는 비동기 호출관리, 메모리누출 방지, 시스템에서 호출 폐기 후 호출을 하는지 확인해야한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>ui컨트롤러는 주로 ui 데이터를 표시하거나, 사용자 작업에 반응하거나, 권한요청과 같은 커뮤니케이션을 처리하기 위한 것이다. 여기에 데이터베이스나 네트워크 데이터 로드를 담당하도록 요구하면 클래스가 팽창한다. 이는 테스트를 어렵게 만든다.</p>

<p><code class="language-plaintext highlighter-rouge">ViewModel</code>은 UI 컨트롤러에서 뷰 데이터 소유권을 분리하는 방법을 제공한다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// WordViewModel.kt

class WordViewModel(application: Application) : AndroidViewModel(application) {

    private val repository: WordRepository

    val allWords: LiveData&lt;List&lt;Word&gt;&gt;

    init {
        val wordsDao = WordRoomDatabase.getDatabase(application, viewModelScope).wordDao()
        repository = WordRepository(wordsDao)
        allWords = repository.allWords
    }

    fun insert(word: Word) = viewModelScope.launch(Dispatchers.IO) {
        repository.insert(word)
    }
}
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Application</code>을 파라미터로 받고 <code class="language-plaintext highlighter-rouge">AndroidViewModel</code>을 상속받는다.</li>
  <li>init block을 사용하여 인스턴스 생성 시 해야할 로직을 구현한다.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">WordRoomDatabase</code>를 생성하고 Dao 객체를 가져온다.</li>
      <li><code class="language-plaintext highlighter-rouge">WordRepository</code>에 가져온 dao 를 입력하여 인스턴스를 생성한다.</li>
      <li><code class="language-plaintext highlighter-rouge">allWords</code>에 repository 내부에서 변화를 관찰하고 있는 allWords를 입력한다.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">insert(word: Word)</code>
    <ul>
      <li>ui 컨트롤러에서 호출하여 사용한다.</li>
      <li>데이터에 관련된 로직은 viewModel이 담당하고 ui 컨트롤러는 단지 데이터 입력 후 전달만을 담당하게 된다.</li>
      <li><code class="language-plaintext highlighter-rouge">viewModelScope</code>를 사용하여 코루틴을 구현한다.
        <ul>
          <li>위에서 생성된 repository내부의 insert() 메소드를 통해 Word 데이터를 추가한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h5 id="ui-controller의-viewmodel"><code class="language-plaintext highlighter-rouge">UI Controller</code>의 <code class="language-plaintext highlighter-rouge">ViewModel</code></h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ArchiTecturecomponentActivity.kt 

...
private lateinit var wordViewModel: WordViewModel

override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_architecture_component)
		
		...

    wordViewModel = ViewModelProvider(this).get(WordViewModel::class.java)
    wordViewModel.allWords.observe(this, Observer { words -&gt;
        // Update the cached copy of the words in the adapter.
        words?.let { adapter.setWords(it) }
    })

		...
}
...
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ViewModelProvider(this).get(WordViewModel::class.java)</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">ViewModel</code>인스턴스 생성</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">wordViewModel.allWords.observe{}</code>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">ViewModel</code> 내부의 <code class="language-plaintext highlighter-rouge">allWords</code> 객체를  <code class="language-plaintext highlighter-rouge">observe{}</code> 통해 관찰한다.
        <ul>
          <li>관찰하고 있다가 변동이 발생한 경우 <code class="language-plaintext highlighter-rouge">apdater.setWords(it)</code>로 객체를 전달한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// WordListAdapter.kt
...

    override fun onBindViewHolder(holder: WordViewHolder, position: Int) {
        val current = words[position]
        holder.wordItemView.text = current.word
    }

    internal fun setWords(words: List&lt;Word&gt;) {
        this.words = words
        notifyDataSetChanged()
    }
...
</code></pre></div></div>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Activity</code>에서 <code class="language-plaintext highlighter-rouge">viewModel</code>을 통해 관찰하고있던 <code class="language-plaintext highlighter-rouge">allWords</code>가 이곳에 전달된다.
    <ul>
      <li>전달되었다는 뜻은 변경되었다는 것을 의미한다.</li>
      <li><code class="language-plaintext highlighter-rouge">notifiDataSetChanged()</code>메소드로 변경되었음을 알린다.
        <ul>
          <li>그렇게 되면 adpater 내부에서 자동으로 <code class="language-plaintext highlighter-rouge">onBindViewHolder</code> 를 호출한다.
            <ul>
              <li>재정비 된 words 에서 변경된 내용이 업데이트 된다.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>다시한번 아래 이미지를 보며서 정리해보자.</p>

<p float="center">
<img src="/assets/images/png/architectureComponent.png" width="100%" />
</p>

<p>다시보니 ViewModel에서 UI 컨트롤러에 변동사항을 알리는것을 제외하곤  화살표의 방향이 아래로만 되어있는것이 눈에 들어온다.  이러한 flow가 생겨난 이유는 UI 컨트롤러에서 view를 표시하고 사용자 행동에 반응하는 <code class="language-plaintext highlighter-rouge">UI Control</code> 이외의 작업이 추가되어 팽창하는것을 막기 위함이다.  여기서 이외의 작업을 담당하기위해 분리 된 것이 <code class="language-plaintext highlighter-rouge">ViewModel</code>이다. 여기서 중요한것은 <code class="language-plaintext highlighter-rouge">UI Controller</code>는 <code class="language-plaintext highlighter-rouge">ViewModel</code>를 생성하고 접근하지만 <code class="language-plaintext highlighter-rouge">ViewModel</code>은 <code class="language-plaintext highlighter-rouge">UI Controller</code>의 존재를 알지 못하여 직접적으로 접근할 수 없다는 것이다. 
<code class="language-plaintext highlighter-rouge">ViewModel</code>은 수명주기를 고려하여 UI관련 데이터를 관리한다. 그리고 데이터베이스에서 데이터를 crud하는 작업을 <code class="language-plaintext highlighter-rouge">Repository</code>에게 일임한다. 이렇게 완벽히 분리된 상태에서 변동된 데이터를 <code class="language-plaintext highlighter-rouge">UI Controller</code>에 전달하기 위해 존재하는 것이 <code class="language-plaintext highlighter-rouge">LiveData</code>이다. <code class="language-plaintext highlighter-rouge">LiveData</code>는 <code class="language-plaintext highlighter-rouge">UI Controller</code>의 수명주기를 알고있으며 관리를 하기로한 객체에 대해 <code class="language-plaintext highlighter-rouge">Observer</code>를 두고 변동을 감지한다.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#kotlin" class="page__taxonomy-item" rel="tag">Kotlin</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#mvvm" class="page__taxonomy-item" rel="tag">MVVM</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#android-kotlin" class="page__taxonomy-item" rel="tag">android-kotlin</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-10-23T00:00:00+09:00">October 23, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Architecture+Components+Example+-+Room%2C+LiveData%2C+ViewModel%20http%3A%2F%2Flocalhost%3A4000%2Fandroid-kotlin%2Fimplementing-mvvm-android-livedata%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fandroid-kotlin%2Fimplementing-mvvm-android-livedata%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fandroid-kotlin%2Fimplementing-mvvm-android-livedata%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/data-binding-in-android-example/" class="pagination--pager" title="Data Binding in Android Example
">Previous</a>
    
    
      <a href="/android-kotlin/using-dagger-hilt-in-android-example/" class="pagination--pager" title="Using dagger-hilt in Android Example
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/background/teaser1.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/android-kotlin/using-dagger-hilt-in-android-example/" rel="permalink">Using dagger-hilt in Android Example
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          11 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/background/teaser1.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/data-binding-in-android-example/" rel="permalink">Data Binding in Android Example
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">
  

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/background/teaser1.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/android-ui/android-snackbar-move-to-activity-in-fragment/" rel="permalink">android snackbar &amp; move to activity in fragment
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">참고자료 
https://github.com/ll0301/architecture-samples/tree/todo-mvvm-live-kotlin
https://developer.android.com/training/snackbar/action?hl=ko
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/background/teaser1.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/android-ui/android-swipe-view/" rel="permalink">android swipe - 터치 좌표를 따라서 view 이동하기
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">참고자료
https://sunghyun1038.tistory.com/24
https://developer.android.com/training/gestures/viewgroup?hl=ko
https://developer.android.com/guide/topics/graphics/...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://github.com/ll0301" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Jeong Hun Kim. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>










  </body>
</html>
