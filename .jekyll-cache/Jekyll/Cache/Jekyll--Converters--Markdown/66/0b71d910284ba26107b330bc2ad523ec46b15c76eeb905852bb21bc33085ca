I"<p float="center">
  <img src="/assets/images/gif/2020-10-2323-36.gif" width="300" />
</p>

<p>Data Binding 예제를 정리한 글</p>

<p>참고자료 <br />
<a href="https://developer.android.com/topic/libraries/data-binding?hl=ko">Data Binding - 공식문서</a> <br />
<a href="https://codelabs.developers.google.com/codelabs/android-databinding?hl=ko#0">Data Binding - Example</a></p>
<h2 id="data-binding">Data Binding</h2>
<p float="center">
<img src="/assets/images/png/dataBinding.png" width="100%" />
</p>
<p><code class="language-plaintext highlighter-rouge">DataBinding</code> 라이브러리는 XML 레이아웃의 UI 구성요소를 선언적 형식을 사용하여 데이터 소스에 바인딩할 수 있도록 하는 <code class="language-plaintext highlighter-rouge">Android Jetpack</code> 라이브러리이다. <br />
해당 예제는 정적 데이터와 일부 관측 가능한 데이터를 보여주는 하나의 화면을 가지고 있다. 데이터가 바뀌면 UI가 자동으로 업데이트 된다. 데이터는 <code class="language-plaintext highlighter-rouge">ViewModel</code>에서 제공된다. <code class="language-plaintext highlighter-rouge">MVVM</code> (Model / View / ViewModel) 은 Data Binding과 잘 어울리는 프레젠테이션 계층 패턴이다.</p>

<h2 id="data-binding-example">Data Binding Example</h2>
<p>해당 예제는 총 6가지로 구현되어있다. 처음에는 <code class="language-plaintext highlighter-rouge">ViewModel</code> 만 사용하여 구현하였고 점차 <code class="language-plaintext highlighter-rouge">DataBinding</code>과 <code class="language-plaintext highlighter-rouge">LiveData</code> 가 추가되면서 <code class="language-plaintext highlighter-rouge">MVVM</code>의 모습을 갖추어 간다.  추가되는 기능들이 어떤 변화를 주는지 제대로 파악하는것이 목표이다.</p>

<p>처음에는 <code class="language-plaintext highlighter-rouge">ViewModel</code>이 간략하게  정의되어있다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// ViewModel

class SimpleViewModel : ViewModel() {
    val name = "Grace"
    val lastName = "Hopper"
    var likes = 0
        private set // This is to prevent external modification of the variable.

    fun onLike() {
        likes++
    }

    val popularity: Popularity
        get() {
            return when {
                likes &gt; 9 -&gt; Popularity.STAR
                likes &gt; 4 -&gt; Popularity.POPULAR
                else -&gt; Popularity.NORMAL
            }
        }
}

enum class Popularity {
    NORMAL,
    POPULAR,
    STAR
}
</code></pre></div></div>
<ul>
  <li>페이지의 데이터가 구현되어있다.
    <ul>
      <li>name, lastName, likes</li>
    </ul>
  </li>
  <li>enum =&gt; NORMAL, POPULAR, START
    <ul>
      <li>likes 가 올라갈 때 마다 이미지가 변경될때 지정되는 enum type</li>
    </ul>
  </li>
  <li>onLike()
    <ul>
      <li>like를 1씩 추가하는 메소드</li>
    </ul>
  </li>
</ul>

<h5 id="1-databindingactivitykt">1. DataBindingActivity.kt</h5>
<p><code class="language-plaintext highlighter-rouge">XML</code>+ <code class="language-plaintext highlighter-rouge">Activity</code> + <code class="language-plaintext highlighter-rouge">ViewModel</code>로 구현되어있다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// DataBindingActivity.kt

private val viewModel by lazy { ViewModelProvider(this).get(SimpleViewModel::class.java) }
</code></pre></div></div>
<ul>
  <li>SimpleViewModel로 <code class="language-plaintext highlighter-rouge">ViewModel</code> 인스턴스를 생성한다.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// DataBindingActivity.kt 

fun onLike(view: View) {
        viewModel.onLike()
        updateLikes()
    }

   private fun updateName() {
        findViewById&lt;TextView&gt;(R.id.plain_name).text = viewModel.name
        findViewById&lt;TextView&gt;(R.id.plain_lastname).text = viewModel.lastName
    }

   private fun updateLikes() {
        findViewById&lt;TextView&gt;(R.id.likes).text = viewModel.likes.toString()
        findViewById&lt;ProgressBar&gt;(R.id.progressBar).progress =
            (viewModel.likes * 100 / 5).coerceAtMost(100)
        val image = findViewById&lt;ImageView&gt;(R.id.imageView)

        val color = getAssociatedColor(viewModel.popularity, this)

        ImageViewCompat.setImageTintList(image, ColorStateList.valueOf(color))

        image.setImageDrawable(getDrawablePopularity(viewModel.popularity, this))
    }
</code></pre></div></div>
<ul>
  <li>onLike(), updateName(), updateLikes() 모두 ui 데이터를 업데이트 하는데 사용되는 메소드다.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">findViewById</code> 가 자중 사용된다.</li>
      <li>updateLikes() 에서는 likes 숫자와 이미지 종류 + 색상까지 update 해야하므로 코드줄이 길어졌다.</li>
    </ul>
  </li>
</ul>
:ET